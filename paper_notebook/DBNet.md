# DBNet论文阅读

> 论文：Shape Robust Text Detection with Progressive Scale Expansion Network
>
> 发表期刊：
>
> 发表时间：2019

### 1.介绍

#### 1.1为什么提出DBNet?

目前主流的检测方法都基于分割来实现的，因为分割的方法能处理任意形状的文本行。而这些方法都需要复杂的后处理操作，来将预测的像素级特征图转化为文本区域或实例，极大增加了模型的推理时间。所以，作者提出Differentiable Binarization，并将它变成网络的一个模块，在加快推理时间的同时，提高了模型的效果。

主要思路是：一般的后处理包括两步（1）固定阈值的二值化处理（2）启发式方法得到文本实例或者CC。作者觉得固定的阈值不好，可以改成自适应的，即每个像素点采用不同的阈值，因此作者提出了Differentiable Binarization，利用网络预测阈值图。作者将二值化的模块插入到网络中去学习怎么预测阈值图。同时，可以不需要复杂的启发示后处理方法就可以得到文本实例，因此，模型的推理速度有很大提升。

### 2.网络

DBNet网络结构如下：

![](F:\NoteBook\.gitbook\assets\DBNet网络结构.png)

其中，`conv3,conv4,conv5`模块的$3*3$卷积使用`deformable convolution`

#### 2.1 二值化

提出的DB的公式和曲线如下：

![](F:\NoteBook\.gitbook\assets\DB.png)

其中，$P_{i,j}, T_{i,j}$分别表示概率特征图和阈值特征图上像素位置$(i,j)$处的值

![](F:\NoteBook\.gitbook\assets\DB_曲线.png)

#### 2.2 推理过程

推理时可以使用概率特征图（即推理时，不使用阈值特征图分支，可以去掉）或者使用二值特征图。

使用概率特征图的推理过程：

1.输入图片，得到对应的概率特征图；

2.进行阈值处理，阈值设置0.2，得到二值图；

3.从二值图得到连通区域；

4.对结果进行膨胀（因为概率特征图是收缩过的结果），膨胀使用Vatti Clipping算法，膨胀值为$D'$
$$
D'=\frac{A'\times r'}{L'}
$$
**最后是如何得到矩形检测框和不规则文本框的？**

#### 2.2 训练过程

##### 2.2.1 标签生成

标签分为三个特征图：二值图、概率特征图、阈值特征图。

二值图$G$：直接从标注的检测框中获得

概率特征图$G_s$：概率特征图是对二值图的标签进行一定的收缩得到的。采用PSENet中相同的方法。
$$
D=\frac{A \times (1-r^2)}{L}
$$
其中，$A$是检测框的面积，$L$为周长，$r$为收缩率，设置为0.4

阈值特征图$G_t$：阈值特征图是文本区域的轮廓，先对二值图G进行膨胀D，得到$G_d$，由$G_d$和$G_s$得到文本区域的轮廓，最后生成阈值特征图（怎么生成的？）

##### 2.2.2 损失函数

采用多任务损失函数：
$$
L=L_s + \alpha L_b + \beta L_t
$$
其中，$L_s, L_b$损失计算采用BCE，$L_t$采用L1距离

### 3.实验

在ICDAR2015上的结果如下：

![](F:\NoteBook\.gitbook\assets\DB_IC15.png)

